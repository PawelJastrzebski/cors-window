var f=(t,n)=>{let e=n??{width:600,height:400},s=window.screenLeft!=null?window.screenLeft:screen.left,i=window.screenTop!=null?window.screenTop:screen.top,o=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,l=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height,d=0,h=0;e.centered??!0?(d=o/2-e.width/2+s,h=l/2-e.height/2+i):(d=s+(e.moveRight??0),h=i+(e.moveDown??0));let u=e.target??"_blank",a=window.open(t,u,`width=${e.width}, height=${e.height} top=${h}, left=${d}, ${e.options??"resize=yes"}`);return a!=null&&a.focus&&a.focus(),a},r=class t{constructor(n,e,s){this.id=n;this.json=e;this.type=s}parseJson(){return JSON.parse(this.json)}post(n,e){n&&n.postMessage(JSON.stringify(this),e)}static new(n,e){return new t(n,"",e)}static newMsg(n,e){return new t(n,JSON.stringify(e),"msg")}static unwrap(n){let e=JSON.parse(n);return"type"in e&&"json"in e?Object.assign(new t("null","","msg"),e):null}},g=t=>new URL(t).origin,w=(t,n)=>{if(t.origin!=n)throw new Error(`Invalid message origin: ${t.origin}, allowed: ${n}`)},c=class{constructor(n,e="single",s){this.id=e;this.childOrigin=g(n),setTimeout(()=>{this.childWindow||(this.childWindow=f(n,s))},250),window.addEventListener("message",i=>{var l,d,h;w(i,this.childOrigin);let o=r.unwrap(i.data);o&&o.id==this.id&&(o.type==="msg"&&((l=this.onMessage)==null||l.call(this,o.parseJson())),o.type==="child-open"&&((d=this.onChildOpen)==null||d.call(this)),this.childWindow==null&&o.type==="ping"&&(this.childWindow=i.source,(h=this.onChildAttach)==null||h.call(this),r.new(e,"host-attach").post(this.childWindow,this.childOrigin)))},!1),setInterval(()=>{var i;if(this.childWindow&&this.childWindow.closed){(i=this.onChildClose)==null||i.call(this),this.childWindow=null;return}},100)}childOrigin;childWindow;onMessage=n=>{};onChildOpen=()=>{};onChildAttach=()=>{};onChildClose=()=>{};isConnected(){return!!this.childWindow&&this.childWindow.closed==!1}postMessage(n){r.newMsg(this.id,n).post(this.childWindow,this.childOrigin)}},p=class{constructor(n="single"){this.id=n;setTimeout(()=>this.initialize(),0)}parentOrigin=window.document.referrer;opener=window.opener;onMessage=n=>{};onParentOpen=()=>{};onParentAttach=()=>{};onParentClose=()=>{};isConnected(){return!!this.opener&&this.opener.closed==!1}initialize(){var n;this.opener&&(this.parentOrigin=g(window.document.referrer),window.addEventListener("message",e=>{var i,o;w(e,this.parentOrigin);let s=r.unwrap(e.data);s&&s.id==this.id&&(s.type==="msg"?(i=this.onMessage)==null||i.call(this,s.parseJson()):s.type==="host-attach"&&((o=this.onParentAttach)==null||o.call(this)))},!1),setInterval(()=>{var e;if(this.opener&&this.opener.closed){(e=this.onParentClose)==null||e.call(this),this.opener=null;return}r.new(this.id,"ping").post(this.opener,this.parentOrigin)},100),(n=this.onParentOpen)==null||n.call(this),r.new(this.id,"child-open").post(this.opener,this.parentOrigin))}postMessage(n){r.newMsg(this.id,n).post(this.opener,this.parentOrigin)}};export{p as WindowDialog,c as WindowHost,f as newDialog};
