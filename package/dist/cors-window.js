var f=(t,e)=>{let n=e??{width:600,height:400},s=window.screenLeft!=null?window.screenLeft:screen.left,i=window.screenTop!=null?window.screenTop:screen.top,r=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,h=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height,a=0,c=0;n.centered??!0?(a=r/2-n.width/2+s,c=h/2-n.height/2+i):(a=s+(n.moveRight??0),c=i+(n.moveDown??0));let u=n.target??"_blank",d=window.open(t,u,`width=${n.width}, height=${n.height} top=${c}, left=${a}, ${n.options??"resize=yes"}`);return d!=null&&d.focus&&d.focus(),d},o=class t{constructor(e,n,s){this.id=e;this.json=n;this.type=s}parseJson(){return JSON.parse(this.json)}post(e,n){e&&e.postMessage(JSON.stringify(this),n)}static newPing(e){return new t(e,"","ping")}static newAttache(e){return new t(e,"","attached")}static newMsg(e,n){return new t(e,JSON.stringify(n),"msg")}static unwrap(e){let n=JSON.parse(e);return"type"in n&&"json"in n?Object.assign(new t("null","","msg"),n):null}},p=t=>new URL(t).origin,w=(t,e)=>{if(t.origin!=e)throw new Error(`Invalid message origin: ${t.origin}, allowed: ${e}`)},l=class{constructor(e,n="single",s){this.id=n;this.childOrigin=p(e),setTimeout(()=>{this.childWindow||(this.childWindow=f(e,s))},250),window.addEventListener("message",i=>{var h;w(i,this.childOrigin);let r=o.unwrap(i.data);r&&r.id==this.id&&(r.type==="msg"&&((h=this.onMessage)==null||h.call(this,r.parseJson())),this.childWindow==null&&r.type==="ping"&&(this.childWindow=i.source,o.newAttache(n).post(this.childWindow,this.childOrigin)))},!1),setInterval(()=>{var i;if(this.childWindow&&this.childWindow.closed){(i=this.onChildClose)==null||i.call(this),this.childWindow=null;return}},100)}childOrigin;childWindow;onMessage=e=>{};onChildClose=()=>{};isConnected(){return!!this.childWindow&&this.childWindow.closed==!1}postMessage(e){o.newMsg(this.id,e).post(this.childWindow,this.childOrigin)}},g=class{constructor(e="single"){this.id=e;this.opener&&(this.parentOrigin=p(window.document.referrer),window.addEventListener("message",n=>{var i,r;w(n,this.parentOrigin);let s=o.unwrap(n.data);s&&s.id==this.id&&(s.type==="msg"?(i=this.onMessage)==null||i.call(this,s.parseJson()):s.type==="attached"&&((r=this.onAttache)==null||r.call(this)))},!1),setInterval(()=>{var n;if(this.opener&&this.opener.closed){(n=this.onParentClose)==null||n.call(this),this.opener=null;return}o.newPing(this.id).post(this.opener,this.parentOrigin)},100))}parentOrigin=window.document.referrer;opener=window.opener;onMessage=e=>{};onAttache=()=>{};onParentClose=()=>{};isConnected(){return!!this.opener&&this.opener.closed==!1}postMessage(e){o.newMsg(this.id,e).post(this.opener,this.parentOrigin)}};export{g as WindowDialog,l as WindowHost,f as newDialog};
