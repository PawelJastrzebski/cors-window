var u=JSON.stringify,f=JSON.parse,o=window,M=document,O=(n,t)=>{let e=t??{width:600,height:400},r=o.screenLeft!=null?o.screenLeft:screen.left,s=o.screenTop!=null?o.screenTop:screen.top,i=o.innerWidth,l=o.innerHeight,a=M.documentElement,g=i||(a.clientWidth?a.clientWidth:screen.width),T=l||(a.clientHeight?a.clientHeight:screen.height),d=r+(e.xMove??0),p=s+(e.yMove??0);(e.centered??!0)&&(d+=g/2-e.width/2,p+=T/2-e.height/2);let b=e.target??"_blank",c=o.open(n,b,`width=${e.width}, height=${e.height} top=${p}, left=${d}, ${e.options??"resize=yes"}`);return c!=null&&c.focus&&c.focus(),c},v=n=>new URL(n).origin,C=(n,t)=>{if(n.origin!=t)throw new Error(`Invalid message origin: ${n.origin}, allowed: ${t}`)},h=class n{constructor(t,e,r){this.i=t;this.j=e;this.type=r}parseJson(){return f(this.j)}post(t,e){t&&t.postMessage(u(this),e)}static new(t,e){return new n(t,"",e)}static newMsg(t,e){return new n(t,u(e),"msg")}static unwrap(t){let e=f(t);return"type"in e&&"j"in e?Object.assign(new n("null","","msg"),e):null}static listen(t,e,r){o.addEventListener("message",s=>{C(s,e);let i=n.unwrap(s.data);!i||i.i!=t||r(s.source,i)},!1)}},w=class{constructor(t,e="1",r){this.id=e;this.origin=v(t),setTimeout(()=>{this.child||(this.child=O(t,r))},250),h.listen(this.id,this.origin,(s,i)=>{var l,a,g;i.type==="msg"&&((l=this.onMessage)==null||l.call(this,i.parseJson())),i.type==="child-open"&&((a=this.onChildOpen)==null||a.call(this)),this.child==null&&i.type==="ping"&&(this.child=s,(g=this.onChildAttach)==null||g.call(this),h.new(e,"host-attach").post(this.child,this.origin))}),setInterval(()=>{var s;if(this.child&&this.child.closed){(s=this.onChildClose)==null||s.call(this),this.child=null;return}},100)}origin;child;onMessage=t=>{};onChildOpen=()=>{};onChildAttach=()=>{};onChildClose=()=>{};isConnected(){return!!this.child&&this.child.closed==!1}postMessage(t){h.newMsg(this.id,t).post(this.child,this.origin)}},y=class{constructor(t="1"){this.id=t;setTimeout(()=>this.initialize(),0)}origin;parent=o.opener;onMessage=t=>{};onParentOpen=()=>{};onParentAttach=()=>{};onParentClose=()=>{};isConnected(){return!!this.parent&&this.parent.closed==!1}initialize(){var t;this.parent&&(this.origin=v(M.referrer),h.listen(this.id,this.origin,(e,r)=>{var s,i;r.type==="msg"?(s=this.onMessage)==null||s.call(this,r.parseJson()):r.type==="host-attach"&&((i=this.onParentAttach)==null||i.call(this))}),setInterval(()=>{var e;if(this.parent&&this.parent.closed){(e=this.onParentClose)==null||e.call(this),this.parent=null;return}h.new(this.id,"ping").post(this.parent,this.origin)},100),(t=this.onParentOpen)==null||t.call(this),h.new(this.id,"child-open").post(this.parent,this.origin))}postMessage(t){h.newMsg(this.id,t).post(this.parent,this.origin)}};export{y as WindowDialog,w as WindowHost,O as newDialog};
