var c=Object.defineProperty;var O=Object.getOwnPropertyDescriptor;var y=Object.getOwnPropertyNames;var W=Object.prototype.hasOwnProperty;var T=(t,e)=>{for(var n in e)c(t,n,{get:e[n],enumerable:!0})},v=(t,e,n,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of y(e))!W.call(t,i)&&i!==n&&c(t,i,{get:()=>e[i],enumerable:!(s=O(e,i))||s.enumerable});return t};var M=t=>v(c({},"__esModule",{value:!0}),t);var b={};T(b,{WindowDialog:()=>g,WindowHost:()=>p,newDialog:()=>w});module.exports=M(b);var w=(t,e)=>{let n=e??{width:600,height:400},s=window.screenLeft!=null?window.screenLeft:screen.left,i=window.screenTop!=null?window.screenTop:screen.top,o=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,l=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height,d=0,h=0;n.centered??!0?(d=o/2-n.width/2+s,h=l/2-n.height/2+i):(d=s+(n.moveRight??0),h=i+(n.moveDown??0));let m=n.target??"_blank",a=window.open(t,m,`width=${n.width}, height=${n.height} top=${h}, left=${d}, ${n.options??"resize=yes"}`);return a!=null&&a.focus&&a.focus(),a},r=class t{constructor(e,n,s){this.id=e;this.json=n;this.type=s}parseJson(){return JSON.parse(this.json)}post(e,n){e&&e.postMessage(JSON.stringify(this),n)}static new(e,n){return new t(e,"",n)}static newMsg(e,n){return new t(e,JSON.stringify(n),"msg")}static unwrap(e){let n=JSON.parse(e);return"type"in n&&"json"in n?Object.assign(new t("null","","msg"),n):null}},u=t=>new URL(t).origin,f=(t,e)=>{if(t.origin!=e)throw new Error(`Invalid message origin: ${t.origin}, allowed: ${e}`)},p=class{constructor(e,n="single",s){this.id=n;this.childOrigin=u(e),setTimeout(()=>{this.childWindow||(this.childWindow=w(e,s))},250),window.addEventListener("message",i=>{var l,d,h;f(i,this.childOrigin);let o=r.unwrap(i.data);o&&o.id==this.id&&(o.type==="msg"&&((l=this.onMessage)==null||l.call(this,o.parseJson())),o.type==="child-open"&&((d=this.onChildOpen)==null||d.call(this)),this.childWindow==null&&o.type==="ping"&&(this.childWindow=i.source,(h=this.onChildAttach)==null||h.call(this),r.new(n,"host-attach").post(this.childWindow,this.childOrigin)))},!1),setInterval(()=>{var i;if(this.childWindow&&this.childWindow.closed){(i=this.onChildClose)==null||i.call(this),this.childWindow=null;return}},100)}childOrigin;childWindow;onMessage=e=>{};onChildOpen=()=>{};onChildAttach=()=>{};onChildClose=()=>{};isConnected(){return!!this.childWindow&&this.childWindow.closed==!1}postMessage(e){r.newMsg(this.id,e).post(this.childWindow,this.childOrigin)}},g=class{constructor(e="single"){this.id=e;setTimeout(()=>this.initialize(),0)}parentOrigin=window.document.referrer;opener=window.opener;onMessage=e=>{};onParentOpen=()=>{};onParentAttach=()=>{};onParentClose=()=>{};isConnected(){return!!this.opener&&this.opener.closed==!1}initialize(){var e;this.opener&&(this.parentOrigin=u(window.document.referrer),window.addEventListener("message",n=>{var i,o;f(n,this.parentOrigin);let s=r.unwrap(n.data);s&&s.id==this.id&&(s.type==="msg"?(i=this.onMessage)==null||i.call(this,s.parseJson()):s.type==="host-attach"&&((o=this.onParentAttach)==null||o.call(this)))},!1),setInterval(()=>{var n;if(this.opener&&this.opener.closed){(n=this.onParentClose)==null||n.call(this),this.opener=null;return}r.new(this.id,"ping").post(this.opener,this.parentOrigin)},100),(e=this.onParentOpen)==null||e.call(this),r.new(this.id,"child-open").post(this.opener,this.parentOrigin))}postMessage(e){r.newMsg(this.id,e).post(this.opener,this.parentOrigin)}};0&&(module.exports={WindowDialog,WindowHost,newDialog});
