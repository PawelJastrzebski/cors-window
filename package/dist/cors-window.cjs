var p=Object.defineProperty;var w=Object.getOwnPropertyDescriptor;var W=Object.getOwnPropertyNames;var $=Object.prototype.hasOwnProperty;var D=(i,t)=>{for(var e in t)p(i,e,{get:t[e],enumerable:!0})},E=(i,t,e,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of W(t))!$.call(i,n)&&n!==e&&p(i,n,{get:()=>t[n],enumerable:!(s=w(t,n))||s.enumerable});return i};var L=i=>E(p({},"__esModule",{value:!0}),i);var I={};D(I,{WindowDialog:()=>f,WindowHost:()=>u,newDialog:()=>T});module.exports=L(I);var h=()=>{},y=JSON.stringify,v=JSON.parse,P=i=>{try{return v(i)}catch{return null}},r=window,m=document,T=(i,t)=>{let e=t??{width:600,height:400},s=r.screenLeft!=null?r.screenLeft:screen.left,n=r.screenTop!=null?r.screenTop:screen.top,o=r.innerWidth,l=r.innerHeight,c=m.documentElement,d=o||(c.clientWidth?c.clientWidth:screen.width),C=l||(c.clientHeight?c.clientHeight:screen.height),M=s+(e.xMove??0),O=n+(e.yMove??0);(e.centered??!0)&&(M+=d/2-e.width/2,O+=C/2-e.height/2);let j=e.target??"_blank",a=r.open(i,j,`width=${e.width}, height=${e.height} top=${O}, left=${M}, ${e.options??"resize=yes"}`);return a!=null&&a.focus&&a.focus(),a},b=i=>new URL(i).origin,S=(i,t)=>{if(i.origin!=t)throw new Error(`Invalid message origin: ${i.origin}, allowed: ${t}`)},x=(i,t,e)=>{r.addEventListener("message",s=>{let n=P(s.data);n&&n.type&&n.i===i&&(S(s,t),e(s.source,n))},!1)},g=(i,t,e,s,n)=>{let o={i:e,j:n,type:s};i==null||i.postMessage(y(o),t)},u=class{constructor(t,e="1",s){this.id=e;this.origin=b(t),setTimeout(()=>{this.child||(this.child=T(t,s))},250),x(this.id,this.origin,(n,o)=>{var l,c,d;o.type==="msg"&&((l=this.onMessage)==null||l.call(this,v(o.j))),o.type==="child-open"&&((c=this.onChildOpen)==null||c.call(this)),n&&this.child==null&&o.type==="ping"&&(this.child=n,(d=this.onChildAttach)==null||d.call(this),g(this.child,this.origin,e,"host-attach",""))}),setInterval(()=>{var n;if(this.child&&this.child.closed){(n=this.onChildClose)==null||n.call(this),this.child=null;return}},100)}origin;child;onMessage=h;onChildOpen=h;onChildAttach=h;onChildClose=h;isOpen(){return!!this.child&&this.child.closed==!1}post(t){g(this.child,this.origin,this.id,"msg",y(t))}},f=class{constructor(t="1"){this.id=t;setTimeout(()=>this.init(),0)}origin;parent=r.opener;onMessage=h;onParentOpen=h;onParentAttach=h;onParentClose=h;isOpen(){return!!this.parent&&this.parent.closed==!1}init(){var t;this.parent&&(this.origin=b(m.referrer),x(this.id,this.origin,(e,s)=>{var n,o;s.type==="msg"?(n=this.onMessage)==null||n.call(this,v(s.j)):s.type==="host-attach"&&((o=this.onParentAttach)==null||o.call(this))}),setInterval(()=>{var e;if(this.parent&&this.parent.closed){(e=this.onParentClose)==null||e.call(this),this.parent=null;return}g(this.parent,this.origin,this.id,"ping","")},100),(t=this.onParentOpen)==null||t.call(this),g(this.parent,this.origin,this.id,"child-open",""))}post(t){g(this.parent,this.origin,this.id,"msg",y(t))}};0&&(module.exports={WindowDialog,WindowHost,newDialog});
