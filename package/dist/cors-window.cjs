var d=Object.defineProperty;var j=Object.getOwnPropertyDescriptor;var m=Object.getOwnPropertyNames;var x=Object.prototype.hasOwnProperty;var J=(i,t)=>{for(var e in t)d(i,e,{get:t[e],enumerable:!0})},W=(i,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of m(t))!x.call(i,n)&&n!==e&&d(i,n,{get:()=>t[n],enumerable:!(r=j(t,n))||r.enumerable});return i};var $=i=>W(d({},"__esModule",{value:!0}),i);var E={};J(E,{WindowDialog:()=>u,WindowHost:()=>p,newDialog:()=>T});module.exports=$(E);var y=JSON.stringify,M=JSON.parse,o=window,v=document,T=(i,t)=>{let e=t??{width:600,height:400},r=o.screenLeft!=null?o.screenLeft:screen.left,n=o.screenTop!=null?o.screenTop:screen.top,s=o.innerWidth,l=o.innerHeight,a=v.documentElement,g=s||(a.clientWidth?a.clientWidth:screen.width),O=l||(a.clientHeight?a.clientHeight:screen.height),f=r+(e.xMove??0),w=n+(e.yMove??0);(e.centered??!0)&&(f+=g/2-e.width/2,w+=O/2-e.height/2);let C=e.target??"_blank",c=o.open(i,C,`width=${e.width}, height=${e.height} top=${w}, left=${f}, ${e.options??"resize=yes"}`);return c!=null&&c.focus&&c.focus(),c},b=i=>new URL(i).origin,D=(i,t)=>{if(i.origin!=t)throw new Error(`Invalid message origin: ${i.origin}, allowed: ${t}`)},h=class i{constructor(t,e,r){this.i=t;this.j=e;this.type=r}parseJson(){return M(this.j)}post(t,e){t&&t.postMessage(y(this),e)}static new(t,e){return new i(t,"",e)}static newMsg(t,e){return new i(t,y(e),"msg")}static unwrap(t){let e=M(t);return"type"in e&&"j"in e?Object.assign(new i("null","","msg"),e):null}static listen(t,e,r){o.addEventListener("message",n=>{D(n,e);let s=i.unwrap(n.data);!s||s.i!=t||r(n.source,s)},!1)}},p=class{constructor(t,e="1",r){this.id=e;this.origin=b(t),setTimeout(()=>{this.child||(this.child=T(t,r))},250),h.listen(this.id,this.origin,(n,s)=>{var l,a,g;s.type==="msg"&&((l=this.onMessage)==null||l.call(this,s.parseJson())),s.type==="child-open"&&((a=this.onChildOpen)==null||a.call(this)),this.child==null&&s.type==="ping"&&(this.child=n,(g=this.onChildAttach)==null||g.call(this),h.new(e,"host-attach").post(this.child,this.origin))}),setInterval(()=>{var n;if(this.child&&this.child.closed){(n=this.onChildClose)==null||n.call(this),this.child=null;return}},100)}origin;child;onMessage=t=>{};onChildOpen=()=>{};onChildAttach=()=>{};onChildClose=()=>{};isConnected(){return!!this.child&&this.child.closed==!1}postMessage(t){h.newMsg(this.id,t).post(this.child,this.origin)}},u=class{constructor(t="1"){this.id=t;setTimeout(()=>this.initialize(),0)}origin;parent=o.opener;onMessage=t=>{};onParentOpen=()=>{};onParentAttach=()=>{};onParentClose=()=>{};isConnected(){return!!this.parent&&this.parent.closed==!1}initialize(){var t;this.parent&&(this.origin=b(v.referrer),h.listen(this.id,this.origin,(e,r)=>{var n,s;r.type==="msg"?(n=this.onMessage)==null||n.call(this,r.parseJson()):r.type==="host-attach"&&((s=this.onParentAttach)==null||s.call(this))}),setInterval(()=>{var e;if(this.parent&&this.parent.closed){(e=this.onParentClose)==null||e.call(this),this.parent=null;return}h.new(this.id,"ping").post(this.parent,this.origin)},100),(t=this.onParentOpen)==null||t.call(this),h.new(this.id,"child-open").post(this.parent,this.origin))}postMessage(t){h.newMsg(this.id,t).post(this.parent,this.origin)}};0&&(module.exports={WindowDialog,WindowHost,newDialog});
